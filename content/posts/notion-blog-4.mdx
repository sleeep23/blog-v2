---
title: ë…¸ì…˜ ë¸”ë¡œê·¸ ë§Œë“¤ê¸° - React Query? ì–œ ë˜ ëˆ„êµ¬ì•¼
description: ë…¸ì…˜ ë¸”ë¡œê·¸ì— React Query ì ìš©í•´ë³¸ ê²½í—˜ ê¸°ë¡!
createdAt: "2023-02-25"
category: í”„ë¡œì íŠ¸
timesToRead: 6
---
ê°œë°œí•˜ë‹¤ê°€ ìƒì„¸ ë¼ìš°íŠ¸ì—ì„œ ë§¤ë²ˆ ë…¸ì…˜ í˜ì´ì§€ë¥¼ í˜ì¹­í•˜ëŠ”ë° ì‹œê°„ì´ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë¦¬ëŠ”ê²Œ ìƒê°ë³´ë‹¤ ê±°ìŠ¬ë ¸ë‹¤. ìºì‹±í•´ë‘ëŠ” ë°©ë²•ì„ ì—†ì„ê¹Œ ê³ ë¯¼í•˜ê³  ì°¾ì•„ë³´ë‹¤ê°€ React Queryë¥¼ ì•Œì•„ë²„ë ¸ë‹¤..! ì•„ë˜ëŠ” React Query ì ìš©ì— ëŒ€í•œ ê°„ë‹¨í•œ ê¸°ë¡ë“¤ì´ë‹¤!
## React Query ì ìš© ì „

ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ë¥¼ ì ìš©í•˜ê¸° ì „ì—ëŠ” ë§¤ë²ˆ ë¼ìš°íŠ¸ì˜ id ê°’ì„ `useMemo` ë¡œ ê¸°ë¡í•´ë‘ê³  ì´ë¥¼ `useEffect` ì˜ ì˜ì¡´ì„± ë°°ì—´ì— ë“±ë¡í•´ë‘ì–´ idê°€ ë°”ë€” ë•Œë§ˆë‹¤ í˜ì¹­í•˜ë„ë¡ ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤!

```tsx
export const getPost = async (id: string) => {
  const res = await fetch(`${server}/api/posts/${id}`);
  return res.json();
};

export default function SinglePost() {
  const [post, setPost] = useState<PostContentType | undefined>(undefined);
  const router = useRouter();
  const { id } = useMemo(() => {
    return router.query;
  }, [router.query]);

  useEffect(() => {
    const getFn = async () => {
      if (id) {
        const content = await getPost(id as string);
        setPost(() => content);
      }
    };
    getFn();
  }, [id]);

  return (
    <ArticleLayout>
      <section css={sectionStyle}>
        <h1>{post?.title}</h1>
        <p>{post?.date}</p>
        {post && (
          <Image
            css={imgStyle}
            src={post.imgLink as string}
            alt={post.title}
            width={700}
            height={430}
          />
        )}
        {post && <Markdown content={post.content} />}
      </section>
    </ArticleLayout>
  );
}
```

- ìˆœìˆ˜ `useEffect` ë¬¸ ë§Œì„ ì´ìš©í•´ì„œ êµ¬ì„±í•œ ì½”ë“œ

## React-Query ì ìš© í›„

ìƒê°ë³´ë‹¤ ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ëŠ” ì‚¬ìš©í•˜ê¸° ë˜ê²Œ ì‰¬ì› ë‹¤! ê·¸ëƒ¥ `useEffect` ë‚´ë¶€ì˜ ë¹„ë™ê¸° api í˜¸ì¶œë¶€ë¥¼ `useQuery`ì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬í•˜ë©´ ëœë‹¤!

```tsx
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: Infinity,
    },
  },
});

export default function App({ Component, pageProps }: AppProps) {
  return (
    <>
      <GlobalStyles />
      <QueryClientProvider client={queryClient}>
        <Component {...pageProps} />
      </QueryClientProvider>
    </>
  );
}
```

- ì „ì—­ì„ `QueryClientProvider` ë¡œ ê°ì‹¼ í›„ `useQuery` ë¥¼ ì´ìš©í•˜ì—¬ data fetchingì„ ì§„í–‰í•˜ë©´,

```tsx
export default function Index() {
  const [cntMenu, setCntMenu] = useState<string>('All');
  const { isError, isSuccess, isLoading, data, error } = useQuery(
    ['posts'],
    fetchPosts,
    { staleTime: 3000 }
  );

  if (isLoading) {
    console.log('Loading posts ...');
    return (
      <ArticleLayout>
        <div>Loading...</div>
      </ArticleLayout>
    );
  }

  if (isError) {
    console.log('Error : ', error);
    return (
      <ArticleLayout>
        <div>Error...</div>
      </ArticleLayout>
    );
  }
  const posts = data as PostsType;
  const menuItems = posts?.map((db) => db.name);
  return (
    <ArticleLayout>
      <PostsMenu setCntMenu={setCntMenu} menuItems={menuItems} />
      {posts && <Posts cntMenu={cntMenu} data={posts} />}
    </ArticleLayout>
  );
}
```

ì •ë§ ëˆˆì— ë„ê²Œ ì½”ë“œê°€ ì¤„ì—ˆë‹¤! ê²Œë‹¤ê°€ ê²°ê³¼ ê°’ì´ ì˜¨ ì—¬ë¶€ì— ë”°ë¼ì„œ ë¡œë”© ìƒíƒœì™€ ì—ëŸ¬ìƒíƒœê¹Œì§€ ëª¨ë‘ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

## Post - id í˜ì´ì§€ì—ë„ ì ìš©í•œ ê²°ê³¼

```tsx
export default function SinglePost() {
  const [post, setPost] = useState<PostContentType | undefined>(undefined);
  const router = useRouter();
  const { id } = useMemo(() => {
     return router.query;
   }, [router.query]);

   useEffect(() => {
     const getFn = async () => {
       if (id) {
         const content = await getPost(id as string);
         setPost(() => content);
       }
     };
     getFn();
   }, [id]);

  const post = data as PostContentType;
  return (
    <ArticleLayout>
      <section css={sectionStyle}>
        <h1>{post && post.title}</h1>
        <p>{post && post.date}</p>
        {post && (
          <Image
            css={imgStyle}
            src={post.imgLink as string}
            alt={post.title}
            width={700}
            height={430}
          />
        )}
        {post && <Markdown content={post.content} />}
      </section>
    </ArticleLayout>
  );
}
```
ìœ„ì˜ í˜ì´ì§€ë„ `useEffect`ë¥¼ ì´ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ì´ë‹¤. ê·¸ëŸ°ë° react-queryë¥¼ ì ìš©í•œ ê²°ê³¼ ì•„ë˜ì™€ ê°™ì´ ë³€í–ˆë‹¤.

```tsx
export default function SinglePost() {
  const router = useRouter();
  const postId = router.query.id as string;
  const { isLoading, isSuccess, isError, data, error } = useQuery(
    ['single-post', router.query.id],
    () => fetchSinglePost(postId),
    { staleTime: 3000 }
  );

  if (isLoading) {
    console.log(`Loading post ${postId}...`);
    return (
      <ArticleLayout>
        <div>Loading...</div>
      </ArticleLayout>
    );
  }

  if (isError) {
    console.log('Error : ', error);
    return (
      <ArticleLayout>
        <div>Error...</div>
      </ArticleLayout>
    );
  }
  const post = data as PostContentType;

  return (
    <ArticleLayout>
      <section css={sectionStyle}>
        <h1>{post && post.title}</h1>
        <p>{post && post.date}</p>
        {post && (
          <Image
            css={imgStyle}
            src={post.imgLink as string}
            alt={post.title}
            width={700}
            height={430}
          />
        )}
        {post && <Markdown content={post.content} />}
      </section>
    </ArticleLayout>
  );
}
```
ì•„ìš° ê¹”ë”í•´ì§„ê²ƒë´ ğŸ¤©

ê·¸ë¦¬ê³  `React Query` ë¥¼ ì´ìš©í•œ **Caching**ì„ ì§„í–‰í•˜ë‹¤ë³´ë‹ˆ í™•ì‹¤íˆ ì´ë¯¸ ë¡œë”©ëœ í˜ì´ì§€ì— ëŒ€í•œ ë¡œë”© ì†ë„ê°€ ëˆˆì— ë„ê²Œ ë¹¨ë¼ì¡Œë‹¤. ê¸°ì¡´ì˜ ë°©ì‹ì€ ë§¤ë²ˆ í•´ë‹¹ í˜ì´ì§€ì— ì ‘ì†ì‹œ â†’ GET requestë¥¼ notion dbì— ê³„ì† ë‚ ë ¤ì„œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì‹ì´ì—ˆë‹¤. ê·¸ëŸ°ë° ê°“ ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬â€¦ ì´ë¯¸ ìºì‹± í•´ë‘ì–´ì„œ í•´ë‹¹ í˜ì´ì§€ë¥¼ ì´ˆê¸° ë¡œë”© ì´í›„ì— ë“¤ì–´ê°€ë©´ ë°”ë¡œ í¬ìŠ¤íŠ¸ê°€ ë³´ì—¬ì§„ë‹¤. ì •ë§ ë©‹ì§€ë‹¤.
